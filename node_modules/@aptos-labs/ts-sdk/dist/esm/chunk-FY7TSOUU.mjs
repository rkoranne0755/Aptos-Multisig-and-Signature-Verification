import{a as j}from"./chunk-2I56E4T2.mjs";import{g}from"./chunk-7D3RY73L.mjs";import{a as l}from"./chunk-L5I7F3NZ.mjs";import{a as S}from"./chunk-LZS7BQ2B.mjs";import{a as C}from"./chunk-37UZKMJI.mjs";import{i as K,l as k,m as A,n as x,p as b}from"./chunk-5CCHECTE.mjs";import{b as P}from"./chunk-XHCALZ7X.mjs";import{e as h,f as w}from"./chunk-WOOH5MMX.mjs";import{a as d}from"./chunk-IECDO22V.mjs";import{b as p}from"./chunk-KFNDDPOW.mjs";import{jwtDecode as E}from"jwt-decode";async function v(r){let{aptosConfig:s,jwt:i,ephemeralKeyPair:e,uidKey:a="sub",derivationPath:n}=r,t={jwt_b64:i,epk:e.getPublicKey().bcsToHex().toStringWithoutPrefix(),exp_date_secs:e.expiryDateSecs,epk_blinder:p.fromHexInput(e.blinder).toStringWithoutPrefix(),uid_key:a,derivation_path:n},{data:o}=await h({aptosConfig:s,path:"fetch",body:t,originMethod:"getPepper",overrides:{WITH_CREDENTIALS:!1}});return p.fromHexInput(o.pepper).toUint8Array()}async function _(r){let{aptosConfig:s,jwt:i,ephemeralKeyPair:e,pepper:a=await v(r),uidKey:n="sub"}=r;if(p.fromHexInput(a).toUint8Array().length!==l.PEPPER_LENGTH)throw new Error(`Pepper needs to be ${l.PEPPER_LENGTH} bytes`);let{maxExpHorizonSecs:t}=await b({aptosConfig:s}),o=E(i);if(typeof o.iat!="number")throw new Error("iat was not found");if(t<e.expiryDateSecs-o.iat)throw Error(`The EphemeralKeyPair is too long lived.  It's lifespan must be less than ${t}`);let f={jwt_b64:i,epk:e.getPublicKey().bcsToHex().toStringWithoutPrefix(),epk_blinder:p.fromHexInput(e.blinder).toStringWithoutPrefix(),exp_date_secs:e.expiryDateSecs,exp_horizon_secs:t,pepper:p.fromHexInput(a).toStringWithoutPrefix(),uid_key:n},{data:u}=await w({aptosConfig:s,path:"prove",body:f,originMethod:"getProof",overrides:{WITH_CREDENTIALS:!1}}),c=u.proof,y=new k({a:c.a,b:c.b,c:c.c});return new x({proof:new A(y,0),trainingWheelsSignature:P.fromHex(u.training_wheels_signature),expHorizonSecs:t})}async function V(r){let{aptosConfig:s,jwt:i,jwkAddress:e,uidKey:a,proofFetchCallback:n,pepper:t=await v(r)}=r,o=_({...r,pepper:t}),f=n?o:await o;if(e!==void 0){let y=C.fromJwtAndPepper({jwt:i,pepper:t,jwkAddress:e,uidKey:a}),m=await g({aptosConfig:s,authenticationKey:y.authKey().derivedAddress()});return S.create({...r,address:m,proof:f,pepper:t,proofFetchCallback:n,jwkAddress:e})}let u=K.fromJwtAndPepper({jwt:i,pepper:t,uidKey:a}),c=await g({aptosConfig:s,authenticationKey:u.authKey().derivedAddress()});return l.create({...r,address:c,proof:f,pepper:t,proofFetchCallback:n})}async function O(r){let{aptosConfig:s,sender:i,iss:e}=r,a=r.jwksUrl??(e.endsWith("/")?`${e}.well-known/jwks.json`:`${e}/.well-known/jwks.json`),n=await fetch(a);if(!n.ok)throw new Error(`Failed to fetch JWKS: ${n.status} ${n.statusText}`);let t=await n.json();return j({aptosConfig:s,sender:i.accountAddress,data:{function:"0x1::jwks::update_federated_jwk_set",functionArguments:[e,d.MoveString(t.keys.map(o=>o.kid)),d.MoveString(t.keys.map(o=>o.alg)),d.MoveString(t.keys.map(o=>o.e)),d.MoveString(t.keys.map(o=>o.n))]}})}export{v as a,_ as b,V as c,O as d};
//# sourceMappingURL=chunk-FY7TSOUU.mjs.map